<?php
require '../db.php'; session_start();
if(empty($_SESSION['user']) || $_SESSION['user']['role']!=='admin'){ http_response_code(403); echo "Access denied"; exit; }

// stats
$stats = [];
$res = $mysqli->query("SELECT COUNT(*) as users FROM users");
$stats['users'] = $res->fetch_assoc()['users'];
$res = $mysqli->query("SELECT COUNT(*) as products FROM products");
$stats['products'] = $res->fetch_assoc()['products'];
$res = $mysqli->query("SELECT COUNT(*) as orders, SUM(total) as revenue FROM orders");
$row = $res->fetch_assoc(); $stats['orders']=$row['orders']; $stats['revenue']=$row['revenue'] ?? 0;
?>
<!doctype html><html><head><meta charset="utf-8"><title>Admin Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"></head>
<body class="p-4">
<div class="container">
  <h3>Admin Dashboard</h3>
  <div class="row">
    <div class="col-md-3"><div class="card p-3"><h5>Users</h5><p><?= e($stats['users']) ?></p></div></div>
    <div class="col-md-3"><div class="card p-3"><h5>Products</h5><p><?= e($stats['products']) ?></p></div></div>
    <div class="col-md-3"><div class="card p-3"><h5>Orders</h5><p><?= e($stats['orders']) ?></p></div></div>
    <div class="col-md-3"><div class="card p-3"><h5>Revenue</h5><p>₦<?= number_format($stats['revenue'],2) ?></p></div></div>
  </div>
  <hr>
  <a class="btn btn-primary" href="products.php">Manage Products</a>
  <a class="btn btn-secondary" href="../index.php">View Site</a>
</div>
</body></html>
11. Admin Product CRUD — admin/products.php (list + create link, edit/delete separate)
Due to length I’ll include key parts: create product (upload) and list.

admin/create_product.php (image upload + prepared stmt)

php
Copy code
<?php
require '../db.php'; session_start(); if($_SESSION['user']['role']!=='admin'){die('Access denied');}
$errors=[];
if($_SERVER['REQUEST_METHOD']==='POST'){
  $title = trim($_POST['title'] ?? '');
  $desc = trim($_POST['description'] ?? '');
  $price = floatval($_POST['price'] ?? 0);
  $stock = intval($_POST['stock'] ?? 0);
  if(!$title) $errors[]='Title required';

  $imageName = null;
  if(!empty($_FILES['image']['name'])){
    $file = $_FILES['image'];
    $allowed = ['image/jpeg','image/png','image/gif'];
    if($file['error'] !== 0) $errors[]='File error';
    if($file['size'] > 2*1024*1024) $errors[]='File > 2MB';
    $finfo = finfo_open(FILEINFO_MIME_TYPE); $mime = finfo_file($finfo,$file['tmp_name']); finfo_close($finfo);
    if(!in_array($mime,$allowed)) $errors[]='Invalid image';
    if(!$errors){
      $ext = pathinfo($file['name'], PATHINFO_EXTENSION);
      $imageName = uniqid('p_').'.'.$ext;
      move_uploaded_file($file['tmp_name'], __DIR__.'/../uploads/'.$imageName);
    }
  }

  if(!$errors){
    $slug = preg_replace('/[^a-z0-9]+/i','-', strtolower($title)).'-'.time();
    $stmt = $mysqli->prepare("INSERT INTO products (title,slug,description,price,stock,image) VALUES (?,?,?,?,?,?)");
    $stmt->bind_param('ssdiis',$title,$slug,$desc,$price,$stock,$imageName);
    if($stmt->execute()){ header('Location: products.php'); exit; } else $errors[]='DB error';
  }
}
?>
<!-- simple form -->
<!doctype html><html><head><meta charset="utf-8"><title>Create Product</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"></head>
<body class="p-4"><div class="container" style="max-width:720px;">
  <h3>Create Product</h3>
  <?php foreach($errors as $err): ?><div class="alert alert-danger"><?= e($err) ?></div><?php endforeach; ?>
  <form method="post" enctype="multipart/form-data">
    <input name="title" class="form-control mb-2" placeholder="Title">
    <textarea name="description" class="form-control mb-2" placeholder="Description"></textarea>
    <input name="price" class="form-control mb-2" placeholder="Price">
    <input name="stock" class="form-control mb-2" placeholder="Stock">
    <input type="file" name="image" class="form-control mb-2" accept="image/*">
    <button class="btn btn-primary">Create</button>
    <a class="btn btn-link" href="products.php">Back</a>
  </form>
</div></body></html>

